---
import Layout from '../../layouts/Layout.astro';
import DynamicSnippetList from '../../components/DynamicSnippetList';
import { getSnippets, getTags } from '../../lib/api';
import { Hash } from 'lucide-react';

export async function getStaticPaths() {
  const tags = await getTags();
  return tags.map((tag) => ({
    params: { slug: tag.slug },
    props: { tag },
  }));
}

const { tag } = Astro.props;
const tagId = (tag as any).id || (tag as any).term_id;

const snippets = await getSnippets({ 
  'snippet-tags': tagId,
  per_page: 100 
});
---

<Layout title={`Etiqueta: ${tag.name}`}>
  <section class="pt-32 pb-20 px-6 border-b-2 border-[var(--text-primary)] bg-[var(--bg-secondary)]">
    <div class="max-w-7xl mx-auto">
      <div class="flex items-center gap-3 mb-6">
         <div class="w-10 h-10 bg-[#ff3344] flex items-center justify-center text-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]">
            <Hash size={20} />
         </div>
         <span class="text-xs font-black uppercase tracking-[0.3em]">Nodo de Referencia</span>
      </div>
      <h1 class="text-5xl md:text-8xl font-black uppercase tracking-tighter leading-[0.9] mb-8 italic">
        #{tag.name}<span class="text-[#ff3344]">.</span>
      </h1>
      <p class="text-lg font-bold text-[var(--text-secondary)] max-w-xl uppercase tracking-tight leading-tight">
        Recursos t√©cnicos detectados bajo este descriptor.
      </p>
    </div>
  </section>

  <div class="max-w-7xl mx-auto px-6 py-24">
    <DynamicSnippetList
      staticSnippets={snippets}
      apiParams={{ 'snippet-tags': tagId }}
      emptyMessage="Sin Despliegues para este Tag"
      client:load
    />
  </div>
</Layout>
