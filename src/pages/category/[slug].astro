---
import Layout from '../../layouts/Layout.astro';
import DynamicSnippetList from '../../components/DynamicSnippetList';
import { getSnippets, getCategories } from '../../lib/api';
import { Folder } from 'lucide-react';

export async function getStaticPaths() {
  const categories = await getCategories();
  return categories.map((category) => ({
    params: { slug: category.slug },
    props: { category },
  }));
}

const { category } = Astro.props;
const categoryId = (category as any).id || (category as any).term_id;

const snippets = await getSnippets({ 
  'snippet-categories': categoryId,
  per_page: 100 
});
---

<Layout title={`Categoría: ${category.name}`}>
  <section class="pt-32 pb-20 px-6 border-b-2 border-[var(--text-primary)] bg-[var(--bg-secondary)]">
    <div class="max-w-7xl mx-auto">
      <div class="flex items-center gap-3 mb-6">
         <div class="w-10 h-10 bg-[#ff3344] flex items-center justify-center text-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]">
            <Folder size={20} />
         </div>
         <span class="text-xs font-black uppercase tracking-[0.3em]">Directorio de Sistema</span>
      </div>
      <h1 class="text-5xl md:text-8xl font-black uppercase tracking-tighter leading-[0.9] mb-8 italic">
        {category.name}<span class="text-[#ff3344]">.</span>
      </h1>
      <p class="text-lg font-bold text-[var(--text-secondary)] max-w-xl uppercase tracking-tight leading-tight">
        Explorando recursos técnicos clasificados bajo este nodo de conocimiento.
      </p>
    </div>
  </section>

  <div class="max-w-7xl mx-auto px-6 py-24">
    <DynamicSnippetList
      staticSnippets={snippets}
      apiParams={{ 'snippet-categories': categoryId }}
      emptyMessage="Sin Despliegues en esta Categoría"
      client:load
    />
  </div>
</Layout>
